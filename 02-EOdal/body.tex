\section*{Abstract}
Earth Observation by means of remote sensing imagery and gridded environmental data opens tremendous opportunities for systematic capture, quantification and interpretation of plant - environment interactions through space and time. The acquisition, maintenance and processing of these data sources, however, requires a unified software framework for efficient and scalable integrated spatio-temporal analysis taking away the burden of data and file handling from the user. Existing software products either cover only parts of these requirements, exhibit a high degree of complexity, or are closed-source, which limits reproducibility of research. With the open-source Python library EOdal (Earth Observation Data Analysis Library) we propose a novel software that enables the development of fully reproducible spatial data science chains through the strict use of open-source developments.
Thanks to its modular design, EOdal enables advanced data warehousing especially for remote sensing data, sophisticated spatio-temporal analysis and intersection of different data sources, as well as nearly unlimited expandability through application programming interfaces (APIs).

\section{Introduction}
Images from \gls{EO} satellites and in-situ observations are of great importance for ecophysiological \citep{caparros-santiago_land_2021} and agroecological research \citep{karthikeyan_review_2020}. Such data can be used to determine plant traits and allow mapping of plant growing conditions for larger areas using standardized methods \citep{weiss_remote_2020}. Open-access, high-resolution satellite data such as from the European Space Agencies' \gls{S2} mission can resolve field heterogeneity and provide site-specific farming measures operationally. Examples include yield estimates \citep{marshall_optimizing_2018,perich_pixel-based_2023}, extraction of phenological metrics \citep{duarte_qphenometrics_2018}, variable irrigation rates \citep{barker_evaluation_2018} and site-specific fertilization scheduling \citep{mittermayer_analysis_2022}. Remotely sensed plant traits and their dynamic development over time  can further be augmented with environmental covariates such as climate, soil and terrain data, as well as information about farm management to perform integrated analysis on material and energy fluxes across spatio-temporal scales \citep{asam_relationship_2018}.

However, accessing, managing and analyzing \gls{EO} data is complex and often requires solid knowledge of geographic information science and coding to properly handle large spatial data sets. We base this finding on an exhaustive review of existing software tools. For example, the philosophy of the OpenDateCube \footnote{\url{https://www.opendatacube.org/}} initiative is about integrated analysis of \gls{EO} data using standardized interfaces. Installing the software, however, is complex as setting up a database instance is required. The Framework for Operational Radiometric Correction for Environmental monitoring (FORCE) \citep{frantz_forcelandsat_2019} is primarily designed for the creation of \gls{ARD} but does not provide interfaces for data analysis workflows. Analysis workflows using standardized interfaces are the main subject of the openEO\footnote{\url{https://openeo.org/}} project. openEO, however, focuses on cloud environments. Thus, data sets that are not available on externally operated web platforms are currently excluded. This applies particularly to (experimental) research data sets. Researchers therefore often spend a significant amount of time getting the data into an analysis-ready format. Based on the analysis of more than 3000 productive machine learning pipelines at Google, \citet{xin_production_2021} identified great potential for optimization in the area of data management and pre-processing, which also appears to be true in the \gls{EO} area.

For these reasons, we developed the \gls{EOdal} as an open-source Python (3.8+) package designed to make \gls{EO} data analysis tools available to researchers without the need for in-depth knowledge about geoinformation science, coding and remote sensing data handling. A key aspect of \gls{EOdal} is the ability to apply spatial data science methods to data from different sources within a unified framework based on open-source tools. We also intend to provide researchers with an alternative to proprietary software solutions such as the widely used Google Earth Engine \citep{gorelick_google_2017}.

The functionality and structure of \gls{EOdal} is explained in Section \ref{sec:package_struc} of this paper. In Section \ref{sec:reprod_example}, we present a reproducible use case based on an agricultural research question followed by a discussion in Section \ref{sec:eodal_conclusions}.

\section{Description of EOdal}
\label{sec:package_struc}
\gls{EOdal} consists of three layers as shown in Figure \ref{fig:overview}. The layers are organized in a triangle to emphasize their inter-dependencies. The core layer (Figure \ref{fig:overview}, top) provides the Python classes required to perform I/O operations to read and write geo-spatial data sets in a generic way. It is also the basis for data warehousing, i.e., the storage of metadata. Class inheritance extends its capabilities to specific \gls{EO} sensors such as \gls{S2} Multispectral Imager (e.g., for convenient reading of data organized in the Satellite Archive for Europe structure). (Pre-)processing of these datasets is accomplished in the processing layer (Figure \ref{fig:overview}, lower right). Processing steps such as spatial reprojection are often a necessity to combine different datasets for analysis. The analysis layer (Figure \ref{fig:overview}, lower left) enables automatized, reproducible \gls{EO} data management and is the backbone for data-driven analysis of geo-spatial data sets and their spatio-temporal intersection.

Deployment of \gls{EOdal} is independent of an Operating System. Furthermore, \gls{EOdal} can be used on local premises (e.g. for processing research datasets) but also in cloud environments for fast access to large, freely accessible data such as the global \gls{S2} or Landsat archive. To enable fast and scalable deployment required for large-scale analysis tasks \gls{EOdal} can be installed into containerized environments (Docker containers).

\subsection{Core Layer}
The data model of the core layer (Figure \ref{fig:overview} top) follows the object-oriented programming paradigm and includes different classes. There are three classes in the \gls{EOdal} core layer: Bands, RasterCollections and derived (inherited) sensor-specific classes. The Band class represents the base class. In simple terms, a Band refers to a two-dimensional array referenced in a geo-spatial coordinate reference system. A RasterCollection is a collection of zero to $n$ Band objects, which can exist in different spatial reference systems, grid cell sizes (pixel sizes) and spatial extents. Band objects in a collection are identified by names (e.g., "blue", Figure \ref{fig:overview} top right) instead of numeric indices. Bands and RasterCollections can be created from any geo-referenced raster data set understood by Geospatial Data Abstraction Library (GDAL, e.g., GeoTiff), vector features (e.g. Shapefile, GeoJSON), and from numerical arrays (Python libraries, e.g. NumPy, Zarr). Sensor-specific RasterCollections include all the functionalities and attributes of the RasterCollection class, but are tailored to the requirements and capabilities of specific imaging sensors such as, for example, \gls{S2}, or Landsat. The inheritance-based software design allows the introduction of further sensors and makes the core layer extensible also with regard to upcoming future \gls{EO} platforms such as the hyperspectral Copernicus expansion mission CHIME\footnote{\url{https://www.esa.int/Applications/Observing_the_Earth/Copernicus/Going_hyperspectral_for_CHIME}} and beyond.

A further central element of the core layer is the collection of metadata in a spatio-temporal catalog  allowing the filtering of records by data source, time period, and geographic region of interest (ROI). \gls{EOdal} supports \gls{STAC}, which are available in many cloud environments that provide geo-spatial (satellite) data, such as Microsoft Azures Planetary Computer\footnote{\url{https://planetarycomputer.microsoft.com/}}, Amazon Web Services (AWS) Earth\footnote{\url{https://aws.amazon.com/de/earth/}} and the Copernicus Data and Information Access Services (DIAS). For local deployment, \gls{EOdal} offers the possibility to store metadata in a PostgreSQL database with the spatial PostGIS extension.

In terms of spatial data models and standards, \gls{EOdal} supports area (polygons and multi-polygons) as well as point features following the general feature model defined in the ISO 19109 standard \citep{iso_iso_2015}. This allows point-based in-situ observations, for example from weather stations or ground sensors, to be intersected with \gls{EO} data and auxiliary data sources such as Digital Elevation Models (see Section \ref{sec:reprod_example}).

\subsection{Processing Layer}
\label{subsec:processing-layer}
The processing layer (Figure \ref{fig:overview}, lower right) provides functionalities for \gls{EO} data preparation and (pre-)processing. Data preparation is usually necessary to enable the merging datasets from different sensors and platforms. This includes image manipulation methods such as spatial resampling and reprojection from one coordinate system into another or masking operations to mask out bad quality observations or land cover classes.

\subsection{Analysis Layer}
The analysis layer (Figure \ref{fig:overview}, bottom) is used for the analysis of data from \gls{EO} satellites and environmental covariates such as meteorological, terrain, soil and land use data. It builds upon the core layer to query and access different data sources and the processing layer to prepare the data analysis-ready. The underlying complex data management such as the merging of data from satellite tiles and filling of no-data values is hidden from the user in the processing layer (see Section \ref{subsec:processing-layer}).

\gls{EOdal} provides interfaces to widely-used open-source Python libraries (e.g., geopandas, numpy, xarray). This allows users to integrate their own \gls{EO} processing workflows and modules (c.f. section \ref{subsec:supplementary-modules}) to e.g. estimate biochemical, structural or integrated traits such as chlorophyll, leaf area index, yield or land surface phenology (Figure \ref{fig:overview}, lower left). 

\subsection{Applications of EOdal}
\label{subsec:supplementary-modules}
\gls{EOdal} has already been used for studies in agroecological research. \citet{perich_pixel-based_2023} used \gls{EOdal} for pixel-based prediction of crop yield using S2 time series.  In \citet{graf_propagating_2022}, \gls{EOdal} is used to propagate radiometric uncertainty from \gls{S2} reflectance factors to phenological metrics. Moreover, \gls{EOdal} drives the \gls{EO} platform at the Swiss Federal Center of Excellence for Agricultural Research, Agroscope, underpinning its relevance within an operational and governmental environment\footnote{\url{http://www.eoa-team.net/}}.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{EOdal_layers.jpg}
    \caption{Overview of EOdal and its three layers: The core layer (top) handles different input data sources in a standardized way. The analysis layer (bottom left) builds upon the core and the processing layer (bottom right) for data maintenance, querying, intersection and integration into user-defined data science pipelines.}
    \label{fig:overview}
\end{figure}

\section{Usage Example: Interpreting In-Field Growth Heterogeneity Through Time with Topographic and Meteorological Data}
\label{sec:reprod_example}
We illustrate here the potential of EOdal for integrated spatio-temporal analysis over an example ROI from western Switzerland near Lake Neuchâtel ($46.98^\circ N$, $7.07^\circ E$). All results were produced by a single Jupyter notebook (\url{https://doi.org/10.1016/j.compag.2022.107487}) running \gls{EOdal} v0.0.1 on Microsoft Planetary Computer. Due to large-scale land subsidence, the entire region - a former peat land - is subject to increased flood risk \citep{egli_landschaftsdynamik_2020}. An agricultural parcel (12 ha) was affected by flooding during heavy rainfall (360 mm within 30 days) between mid-June and July 2021, causing flood damage to the previously homogeneous green canopy. Figure \ref{fig:s2-fig} shows \gls{S2} derived false-color infra-red images of the parcel in 2021 before the flood (reddish tones in Figure \ref{fig:s2-fig}a). In the spring 2022, differences in canopy greenness of the emerging winter wheat are evident (Figure \ref{fig:s2-fig}b and c). Darker areas, which indicate lower soil cover, can be discerned in the otherwise red-colored canopy. The spatial pattern within the field corresponds to the patterns within the DEM (Figure \ref{fig:s2-fig}e) and reveals that parts with lower elevation values were more impacted by flooding than the rest of the field. Extraction of the Modified Soil Adjusted Vegetation Index (MSAVI, \cite{qi_modified_1994}) time series from two selected S2 pixels (Figure \ref{fig:s2-fig}d) allows to evaluate the impact of the flood in 2021 on the growth dynamic in 2022 and confirms the findings from the false-color S2 images.
As additional usage example, the growth pattern of a field is investigated in relation to meteorological data, often used to validate and calibrate ecophysiological growth models. In this case (Figure \ref{fig:s2-fig}f), the cumulative growing degree days (in °C) and cumulative daily rainfall amount (in mm) were derived from a nearby weather station (Ins) operated by the Swiss Federal Office of Meteorology and Climatology (MeteoSwiss) calculated from November \nth{1} 2021.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{S2_Flood_Crop_Growth_Example.png}
    \caption{Result of a single Jupyter notebook run using \gls{EOdal} (v0.0.1) on Microsoft Planetary Computer. \gls{S2} false-color infra-red composite of the field parcel before the heavy rainfall events in June and July 2021 (a) and spatial heterogeneity in winter wheat green-up during spring 2022 (b-c). In addition, cumulative growing degree days (GDD) and daily precipitation sums derived from a nearby weather station are shown (f). The extent of the flood in 2021 - evident as darker areas in (b-c) - corresponds to a depression visible in the Digital Elevation Model (e). The flood affected plant growing conditions in spring 2022 as shown in the MSAVI time series (d) of a 'flooded' pixel (blue) and a pixel that was little affected by the floods in 2021 (orange). The dashed lines in (d) correspond to the timing of (a), (b) and (c), respectively, whereas the blue rectangle in (d) indicates the approximate timing of the flooding in 2021.}
    \label{fig:s2-fig}
\end{figure}

\section{Discussion and Conclusion}
\label{sec:eodal_conclusions}
%\input{discussion}
The usage example shown in Figure \ref{fig:s2-fig} highlights how \gls{EOdal} can be used to combine different environmental covariates with vegetation dynamics obtained from satellite time series to develop a holistic understanding of plant-environment interactions. This simple example shows how \gls{EOdal} lowers the barriers of entry to \gls{EO} analysis unlocking potential for data-based decision-making in agroecology. In addition, by using Docker and cloud infrastructure, the analysis can be extended to larger spatial and temporal scales. For the future we envision an ecosystem of user modules that build on EOdal, complement themselves and are developed and made freely available to the \gls{EO} community. 

\gls{EOdal} is in line with recent developments in agriculture that allow (technically inexperienced) users to run complex analyses: \citet{godara_agrimine_2022} developed a platform called "AgriMine". The platform enables spatio-temporal analysis of issues in Indian agriculture based on help-desk calls improving the Indian agricultural extension service. Improvements in variety testing were enabled by an online platform in China that makes processes more efficient and lines up with recent incentives in high-throughput phenotyping efforts \citep{pan_online_2022}. Similarly, \gls{EOdal} can contribute to increased use of EO data in agriculture.

Although we focus on agriculture (section \ref{subsec:supplementary-modules}), \gls{EOdal} is not limited to it. Rather, EOdal can be used in all disciplines that process \gls{EO} data and require open, reproducible data analysis workflows. Thus, we expect EOdal to trigger further open-source developments, either through the release of additional Python packages that build on the existing functionalities, or through its integration into existing data processing frameworks. Ultimately, \gls{EOdal} is intended to provide researchers with an alternative to proprietary software platforms while also easing the burden of data management for practitioners. For this reason EOdal is particularly well suitable for educational activities in the field of \gls{EO}. This supports the transition to reproducible science, benefiting the \gls{EO} community as a whole.

\section*{CRediT Authorship Contribution Statement}
Lukas Valentin Graf: Conceptualization, Software, Investigation, Visualization, Writing – original draft, Writing – review \& editing. Gregor Perich: Conceptualization, Software, Writing – original draft, Writing – review \& editing. Helge Aasen: Supervision, Writing – original draft, Writing – review \& editing.

\section*{Declaration of Competing Interest}
The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.

%% create a non-numbered section for the Acknowledgements
\section*{Acknowledgements}
The authors thank Achim Walter from the Crop Science group at ETH for providing the IT infrastructure and in particular Norbert Kirchgessner for his support with data storage and implementation. Furthermore, we thank Alfred Burri for on-site support and contributions to the usage example and Fabio Oriani for valuable comments on the manuscript. The development of EOdal was conducted within the project `PhenomEn' funded by the Swiss Science Foundation (grant number IZCOZ0\_198091). GP acknowledges funding through the project `DeepField' of the Swiss Federal Office for Agriculture (BLW). 